<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WWF Study Guide 2026 ‚Äî Sustainability Programs in Switzerland</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: linear-gradient(175deg, #f6f9f4 0%, #eef2eb 40%, #f0ece4 100%);
  min-height: 100vh; color: #2d3a28;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-8px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes spin {
  to { transform: rotate(360deg); }
}

.header {
  background: linear-gradient(135deg, #2d5a27 0%, #3a7233 50%, #4f7942 100%);
  padding: 48px 32px 40px; position: relative; overflow: hidden;
}
.header::before {
  content: ''; position: absolute; inset: 0;
  background: radial-gradient(circle at 80% 20%, rgba(255,255,255,0.08) 0%, transparent 60%);
}
.header-inner { max-width: 1100px; margin: 0 auto; position: relative; }
.header-brand { display: flex; align-items: center; gap: 16px; margin-bottom: 16px; }
.header-logo {
  width: 48px; height: 48px; background: #fff; border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 24px; font-weight: 800; color: #2d5a27;
  font-family: 'Playfair Display', serif; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
.header-brand span { font-size: 13px; color: rgba(255,255,255,0.75); font-weight: 500; letter-spacing: 1px; text-transform: uppercase; }
.header h1 { font-size: clamp(28px, 4vw, 42px); font-weight: 800; color: #fff; font-family: 'Playfair Display', serif; line-height: 1.15; margin-bottom: 8px; }
.header p { font-size: 16px; color: rgba(255,255,255,0.8); max-width: 600px; line-height: 1.5; }

.filters-wrap { max-width: 1100px; margin: -20px auto 0; padding: 0 24px; position: relative; z-index: 10; }
.filters-card { background: #fff; border-radius: 16px; padding: 24px 28px; box-shadow: 0 4px 24px rgba(45,90,39,0.08); border: 1px solid #e2e8de; }
.search-input {
  width: 100%; padding: 14px 18px; border: 2px solid #d4ddd0; border-radius: 10px;
  font-size: 15px; font-family: 'DM Sans', sans-serif; outline: none;
  transition: border-color 0.2s, background 0.2s; background: #fafcf9; margin-bottom: 20px;
}
.search-input:focus { border-color: #4f7942; background: #fff; }
.search-input::placeholder { color: #a0ad9a; }
.filters-row { display: flex; gap: 16px; flex-wrap: wrap; }
.filter-group { flex: 1 1 180px; min-width: 160px; }
.filter-label { display: block; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.2px; color: #5a6c50; margin-bottom: 6px; }
.filter-select {
  width: 100%; padding: 10px 14px; border: 2px solid #d4ddd0; border-radius: 8px;
  font-size: 14px; font-family: 'DM Sans', sans-serif; background: #fff; color: #2d3a28;
  cursor: pointer; outline: none; transition: border-color 0.2s;
}
.filter-select:focus { border-color: #4f7942; }
.filter-actions { margin-top: 16px; display: flex; align-items: center; gap: 12px; }
.filter-actions span { font-size: 13px; color: #7a8a72; }
.btn-clear {
  background: none; border: 1px solid #d4ddd0; border-radius: 6px;
  padding: 4px 12px; font-size: 12px; color: #5a6c50; cursor: pointer;
  font-family: 'DM Sans', sans-serif; font-weight: 600;
}
.btn-clear:hover { background: #f5f7f3; }

.results-wrap { max-width: 1100px; margin: 24px auto 0; padding: 0 24px 60px; }
.results-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 8px; }
.results-count { font-size: 14px; font-weight: 600; color: #5a6c50; }
.results-badges { display: flex; gap: 6px; flex-wrap: wrap; }
.badge { font-size: 11px; padding: 3px 8px; border-radius: 5px; font-weight: 600; white-space: nowrap; }
.badge-bachelor { background: #e8f5e9; color: #1b5e20; border: 1px solid rgba(46,125,50,0.12); }
.badge-minor { background: #f1f8e9; color: #33691e; border: 1px solid rgba(85,139,47,0.12); }
.badge-master { background: #e3f2fd; color: #0d47a1; border: 1px solid rgba(21,101,192,0.12); }
.badge-weiterbildung { background: #fff3e0; color: #bf360c; border: 1px solid rgba(230,81,0,0.12); }

.programs-list { display: flex; flex-direction: column; gap: 12px; }

.program-card {
  background: #fff; border-radius: 12px; border: 1px solid #e2e8de;
  overflow: hidden; transition: box-shadow 0.25s, transform 0.2s; cursor: pointer;
}
.program-card:hover { box-shadow: 0 4px 20px rgba(79,121,66,0.12); transform: translateY(-2px); }
.card-inner { padding: 20px 24px; }
.border-bachelor { border-left: 4px solid #2e7d32; }
.border-minor { border-left: 4px solid #558b2f; }
.border-master { border-left: 4px solid #1565c0; }
.border-weiterbildung { border-left: 4px solid #e65100; }
.card-top { display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; flex-wrap: wrap; }
.card-main { flex: 1; min-width: 200px; }
.card-title { margin: 0 0 8px; font-size: 16px; font-weight: 700; color: #1a2e14; line-height: 1.35; }
.card-uni-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.card-uni { font-size: 13px; font-weight: 600; color: #4f7942; }
.type-badge { font-size: 11px; padding: 2px 8px; border-radius: 4px; font-weight: 600; }
.type-uni { background: #f3e8ff; color: #6b21a8; }
.type-fh { background: #e8f4fd; color: #0369a1; }
.card-tags { display: flex; gap: 6px; flex-wrap: wrap; align-items: flex-start; }
.tag-level { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 6px; white-space: nowrap; }
.tag-lang { font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 6px; background: #f5f5f0; color: #555; white-space: nowrap; }
.card-discs { display: flex; gap: 4px; margin-top: 10px; flex-wrap: wrap; }
.disc-tag { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 10px; background: #f0f4ee; color: #5a6c50; }
.card-details { margin-top: 16px; padding-top: 16px; border-top: 1px solid #e8ede6; animation: fadeIn 0.3s ease; }
.card-desc { margin: 0 0 12px; font-size: 14px; line-height: 1.6; color: #3a4a35; }
.card-pract { background: #f8faf7; border-radius: 8px; padding: 12px 16px; border: 1px solid #e2e8de; }
.card-pract-lbl { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: #7a8a72; }
.card-pract p { margin: 4px 0 0; font-size: 13px; color: #4a5a44; line-height: 1.5; }
.card-hint { text-align: right; margin-top: 8px; font-size: 12px; color: #9aa896; }

.empty { text-align: center; padding: 60px 20px; color: #7a8a72; }
.empty .ico { font-size: 48px; margin-bottom: 16px; }
.empty h3 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }

.loading { text-align: center; padding: 80px 20px; }
.loading .spinner {
  width: 40px; height: 40px; border: 4px solid #e2e8de;
  border-top-color: #4f7942; border-radius: 50%;
  animation: spin 0.8s linear infinite; margin: 0 auto 20px;
}
.loading p { font-size: 15px; color: #5a6c50; font-weight: 500; }
.loading .sub { font-size: 13px; color: #9aa896; margin-top: 4px; }

.error-box {
  max-width: 600px; margin: 40px auto; padding: 24px; background: #fff3f3;
  border: 1px solid #ffcdd2; border-radius: 12px; text-align: center;
}
.error-box h3 { color: #c62828; margin-bottom: 8px; }
.error-box p { font-size: 14px; color: #555; line-height: 1.6; }
.error-box code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; font-size: 12px; }

.footer { background: #2d3a28; padding: 24px 32px; text-align: center; }
.footer p { font-size: 13px; color: rgba(255,255,255,0.5); }

@media (max-width: 600px) {
  .header { padding: 32px 20px 28px; }
  .filters-wrap, .results-wrap { padding: 0 12px; }
  .filters-card { padding: 16px; }
  .card-inner { padding: 16px; }
  .filter-group { flex: 1 1 100%; }
  .results-wrap { padding-bottom: 40px; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-inner">
    <div class="header-brand">
      <div class="header-logo">W</div>
      <span>WWF Switzerland</span>
    </div>
    <h1>Study Guide 2026</h1>
    <p>Sustainability-focused Bachelor, Master and Continuing Education Programs in Switzerland</p>
  </div>
</div>

<div class="filters-wrap">
  <div class="filters-card">
    <input type="text" id="search" class="search-input" placeholder="üîç Search programs, universities, or topics...">
    <div class="filters-row">
      <div class="filter-group">
        <label class="filter-label">üéì Level</label>
        <select id="fLevel" class="filter-select"><option value="">All</option></select>
      </div>
      <div class="filter-group">
        <label class="filter-label">üìö Discipline</label>
        <select id="fDisc" class="filter-select"><option value="">All</option></select>
      </div>
      <div class="filter-group">
        <label class="filter-label">üèõ University</label>
        <select id="fUni" class="filter-select"><option value="">All</option></select>
      </div>
      <div class="filter-group">
        <label class="filter-label">üè´ University Type</label>
        <select id="fType" class="filter-select"><option value="">All</option></select>
      </div>
      <div class="filter-group">
        <label class="filter-label">üåê Language</label>
        <select id="fLang" class="filter-select"><option value="">All</option></select>
      </div>
    </div>
    <div class="filter-actions" id="fActions" style="display:none">
      <span id="fCount"></span>
      <button class="btn-clear" onclick="clearAll()">Clear all</button>
    </div>
  </div>
</div>

<div class="results-wrap">
  <div class="results-bar">
    <span class="results-count" id="rCount"></span>
    <div class="results-badges" id="rBadges"></div>
  </div>
  <div class="programs-list" id="list">
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading programs...</p>
      <p class="sub">Fetching data from Google Sheets</p>
    </div>
  </div>
</div>

<div class="footer">
  <p>WWF Study Guide 2026 ‚Äî Prototype Demo ¬∑ Data loaded from Google Sheets</p>
</div>

<script>
// ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
// ‚ïë   Google Sheets ID —Ç–∞–±–ª–∏—Ü—ã                                   ‚ïë
// ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

const SHEET_ID = "1jDphHwfUVrKaNgQGu3QDaWhAfyXuEIi4KbrY4g_HwOs";

const DL={Econ:"Economic Sciences",NatSci:"Natural & Environmental Sciences",SocSci:"Social Sciences",EngSci:"Engineering Sciences",ArtDes:"Arts & Design",ComSci:"Computer Science",EdProf:"Education & Pedagogy"};
const LS={Bachelor:{b:"badge-bachelor",c:"border-bachelor",bg:"#e8f5e9",fg:"#1b5e20"},"Bachelor Minor":{b:"badge-minor",c:"border-minor",bg:"#f1f8e9",fg:"#33691e"},Master:{b:"badge-master",c:"border-master",bg:"#e3f2fd",fg:"#0d47a1"},Weiterbildung:{b:"badge-weiterbildung",c:"border-weiterbildung",bg:"#fff3e0",fg:"#bf360c"}};

let DATA = [];
const exp = new Set();
const $ = id => document.getElementById(id);

// ‚îÄ‚îÄ‚îÄ Fetch data via Google Sheets JSONP (bypasses ALL CORS issues) ‚îÄ‚îÄ‚îÄ
function fetchData() {
  // Method 1: JSONP via script tag (guaranteed no CORS)
  const callbackName = 'handleGoogleData';
  
  window[callbackName] = function(response) {
    try {
      if (!response.table || !response.table.rows) {
        showError('No table data found in response');
        return;
      }
      
      const cols = response.table.cols.map(c => (c.label || '').toLowerCase().trim());
      
      // Debug: log what Google returns as column headers
      console.log('Google Sheets columns:', response.table.cols.map(c => c.label));
      console.log('Parsed cols:', cols);
      console.log('Total rows:', response.table.rows.length);
      
      // Try to find columns by header name first
      let iProgram = cols.findIndex(h => h.includes('program'));
      let iUni = cols.findIndex(h => h.includes('university') && !h.includes('type'));
      let iType = cols.findIndex(h => h.includes('university') && h.includes('type'));
      let iLevel = cols.findIndex(h => h.includes('level'));
      let iDisc = cols.findIndex(h => h.includes('discipline') || h.includes('main'));
      let iLang = cols.findIndex(h => h.includes('language') || h.includes('lang'));
      let iDesc = cols.findIndex(h => h.includes('description') || h.includes('desc'));
      let iPract = cols.findIndex(h => h.includes('practical') || h.includes('info'));
      
      // Fallback: if headers are empty, use column positions
      // Expected order: Program, University, University Type, Level, Discipline, Language, Description, Practical Information
      if (iProgram === -1) {
        console.log('Headers not found, using column positions as fallback');
        iProgram = 0;
        iUni = 1;
        iType = 2;
        iLevel = 3;
        iDisc = 4;
        iLang = 5;
        iDesc = 6;
        iPract = 7;
      }
      
      const getVal = (row, idx) => {
        if (idx < 0 || !row.c || !row.c[idx]) return '';
        return (row.c[idx].v || '').toString().trim();
      };
      
      DATA = [];
      for (const row of response.table.rows) {
        const program = getVal(row, iProgram);
        if (!program) continue;
        DATA.push({
          n: program,
          u: getVal(row, iUni),
          t: getVal(row, iType),
          l: getVal(row, iLevel),
          d: getVal(row, iDisc),
          g: getVal(row, iLang),
          desc: getVal(row, iDesc),
          p: getVal(row, iPract)
        });
      }
      
      if (DATA.length === 0) {
        $('list').innerHTML = `
          <div class="error-box">
            <h3>üìã No data found</h3>
            <p>The spreadsheet appears to be empty or the column headers don't match.<br>
            Expected headers: <code>Program</code>, <code>University</code>, <code>University Type</code>, <code>Level</code>, <code>Discipline</code>, <code>Language</code>, <code>Description</code>, <code>Practical Information</code></p>
          </div>`;
        return;
      }
      
      populateFilters();
      render();
    } catch (err) {
      showError(err.message);
    }
  };
  
  function showError(msg) {
    $('list').innerHTML = `
      <div class="error-box">
        <h3>‚ùå Loading error</h3>
        <p>Could not load data from Google Sheets.</p>
        <p style="margin-top:8px">Error: <code>${msg}</code></p>
        <p style="margin-top:12px">Make sure the spreadsheet sharing is set to "Anyone with the link".</p>
      </div>`;
  }
  
  // Load data via script tag (JSONP) ‚Äî no CORS restrictions
  const script = document.createElement('script');
  script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=responseHandler:${callbackName}`;
  script.onerror = function() {
    // Fallback: try fetch method
    fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`)
      .then(r => r.text())
      .then(text => {
        const start = text.indexOf('{');
        const end = text.lastIndexOf('}');
        if (start === -1) throw new Error('Invalid response');
        const json = JSON.parse(text.substring(start, end + 1));
        window[callbackName](json);
      })
      .catch(err => showError(err.message));
  };
  document.head.appendChild(script);
}

// ‚îÄ‚îÄ‚îÄ Filters & Render ‚îÄ‚îÄ‚îÄ
function uniq(a) { return [...new Set(a)].filter(Boolean).sort(); }

function fill(id, opts) {
  const s = $(id);
  // keep only "All" option
  while (s.options.length > 1) s.remove(1);
  opts.forEach(o => { const e = document.createElement('option'); e.value = o; e.textContent = o; s.appendChild(e); });
}

function populateFilters() {
  fill('fLevel', uniq(DATA.map(x => x.l)));
  fill('fDisc', uniq(DATA.flatMap(x => x.d.split(',').map(s => s.trim()))));
  fill('fUni', uniq(DATA.map(x => x.u)));
  fill('fType', uniq(DATA.map(x => x.t)));
  fill('fLang', uniq(DATA.flatMap(x => x.g.split(',').map(s => s.trim()))));
}

function getF() {
  return {
    level: $('fLevel').value, disc: $('fDisc').value,
    uni: $('fUni').value, type: $('fType').value,
    lang: $('fLang').value, q: $('search').value.toLowerCase()
  };
}

function filter() {
  const f = getF();
  return DATA.filter(x => {
    if (f.level && x.l !== f.level) return false;
    if (f.disc && !x.d.includes(f.disc)) return false;
    if (f.uni && x.u !== f.uni) return false;
    if (f.type && x.t !== f.type) return false;
    if (f.lang && !x.g.includes(f.lang)) return false;
    if (f.q) return x.n.toLowerCase().includes(f.q) || x.u.toLowerCase().includes(f.q) || x.desc.toLowerCase().includes(f.q);
    return true;
  });
}

function render() {
  const r = filter(), f = getF();
  const ac = [f.level, f.disc, f.uni, f.type, f.lang].filter(Boolean).length;
  const fa = $('fActions');
  if (ac > 0) { fa.style.display = 'flex'; $('fCount').textContent = ac + ' filter' + (ac > 1 ? 's' : '') + ' active'; }
  else fa.style.display = 'none';
  
  $('rCount').textContent = r.length + ' program' + (r.length !== 1 ? 's' : '') + ' found';

  let bh = '';
  for (const [lv, s] of Object.entries(LS)) {
    const c = r.filter(x => x.l === lv).length;
    if (c) bh += `<span class="badge ${s.b}">${lv}: ${c}</span>`;
  }
  $('rBadges').innerHTML = bh;

  if (!r.length) {
    $('list').innerHTML = '<div class="empty"><div class="ico">üå±</div><h3>No programs found</h3><p>Try adjusting your filters or search terms</p></div>';
    return;
  }

  $('list').innerHTML = r.map(x => {
    const i = DATA.indexOf(x);
    const s = LS[x.l] || LS.Bachelor;
    const o = exp.has(i);
    const ds = x.d.split(',').map(d => d.trim()).filter(Boolean);
    const isUni = x.t.toLowerCase().includes('uni');
    const tc = isUni ? 'type-uni' : 'type-fh';

    return `<div class="program-card" onclick="tog(${i})"><div class="card-inner ${s.c}"><div class="card-top"><div class="card-main"><h3 class="card-title">${esc(x.n)}</h3><div class="card-uni-row"><span class="card-uni">${esc(x.u)}</span><span class="type-badge ${tc}">${esc(x.t)}</span></div></div><div class="card-tags"><span class="tag-level" style="background:${s.bg};color:${s.fg}">${esc(x.l)}</span><span class="tag-lang">${esc(x.g)}</span></div></div><div class="card-discs">${ds.map(d => `<span class="disc-tag">${esc(DL[d] || d)}</span>`).join('')}</div>${o ? `<div class="card-details"><p class="card-desc">${esc(x.desc)}</p>${x.p ? `<div class="card-pract"><span class="card-pract-lbl">Practical Information</span><p>${esc(x.p)}</p></div>` : ''}</div>` : ''}<div class="card-hint">${o ? '‚ñ≤ Click to collapse' : '‚ñº Click for details'}</div></div></div>`;
  }).join('');
}

function esc(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

function tog(i) { if (exp.has(i)) exp.delete(i); else exp.add(i); render(); }

function clearAll() {
  ['fLevel', 'fDisc', 'fUni', 'fType', 'fLang', 'search'].forEach(id => $(id).value = '');
  exp.clear(); render();
}

// Events
document.querySelectorAll('.filter-select').forEach(s => s.addEventListener('change', render));
$('search').addEventListener('input', render);

// Start
fetchData();
</script>
</body>
</html>
